<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Manage Gallery — UltraGC Admin</title>

<style>
body{font-family:Arial,sans-serif;background:#f7f6f3;margin:0}
header{background:#fff;padding:14px;border-bottom:1px solid #eee;display:flex;justify-content:space-between}
.brand{font-weight:700;color:#c1973d}
main{max-width:1000px;margin:30px auto;padding:16px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
.card{background:#fff;border-radius:10px;box-shadow:0 6px 14px rgba(0,0,0,.06);overflow:hidden}
.card img,.card video{width:100%;height:180px;object-fit:cover}
.info{padding:10px}
.info strong{display:block}
.btn{margin-top:6px;padding:6px 10px;border:none;border-radius:6px;cursor:pointer;font-weight:700}
.delete{background:#e74c3c;color:#fff}
.msg{text-align:center;font-weight:700;color:#666;margin-top:30px}
</style>
</head>

<body>

<header>
  <div class="brand">UltraGC Admin — Manage Gallery</div>
  <button onclick="location.href='dashboard.html'">Back</button>
</header>

<main>
  <div id="gallery" class="grid"></div>
  <div id="msg" class="msg">Loading gallery…</div>
</main>

<script>
async function loadGallery(){
  const gallery = document.getElementById("gallery");
  const msg = document.getElementById("msg");

  try{
    const res = await fetch("/.netlify/functions/list-gallery");
    const items = await res.json();

    if(!items.length){
      msg.textContent = "No gallery items yet.";
      return;
    }

    msg.style.display = "none";

    items.forEach(item => {
      const card = document.createElement("div");
      card.className = "card";

      const media = item.resource_type === "video"
        ? `<video src="${item.secure_url}" controls></video>`
        : `<img src="${item.secure_url}">`;

      card.innerHTML = `
        ${media}
        <div class="info">
          <strong>${item.context?.custom?.caption || "No caption"}</strong>
          <small>${item.context?.custom?.category || ""}</small>
          <button class="btn delete" onclick="deleteItem('${item.public_id}')">Delete</button>
        </div>
      `;

      gallery.appendChild(card);
    });

  }catch(err){
    msg.textContent = "Unable to load gallery list.";
  }
}

async function deleteItem(id){
  if(!confirm("Delete this item?")) return;

  await fetch("/.netlify/functions/delete-resource",{
    method:"POST",
    body:JSON.stringify({ public_id:id })
  });

  location.reload();
}

loadGallery();
</script>

</body>
</html>
